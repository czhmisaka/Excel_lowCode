<!--
 * @Date: 2025-10-09 16:41:24
 * @LastEditors: CZH
 * @LastEditTime: 2025-10-09 16:58:13
 * @FilePath: /lowCode_excel/修复说明.md
-->
# 数据导出/导入脚本修复说明

## 问题描述
运行 `exportData.sh` 脚本时出现错误：
```
[ERROR] 缺少必要的依赖: mysql-client mysqldump
[INFO] 请安装缺少的依赖后重试
```

## 问题根源
- 项目支持两种数据库模式：MySQL 和 SQLite
- 但 `exportData.sh` 和 `importData.sh` 脚本强制检查 MySQL 客户端工具
- 即使当前使用 SQLite 数据库，也会报缺少 MySQL 依赖的错误

## 修复方案
对两个脚本进行了以下改进：

### 1. exportData.sh 修复内容
- **智能依赖检查**：根据 `DB_TYPE` 环境变量决定是否检查 MySQL 客户端
- **SQLite 导出支持**：添加了 SQLite 数据库文件复制功能
- **条件数据库导出**：根据数据库类型选择导出方法
- **更新元数据**：正确记录使用的数据库类型

### 2. importData.sh 修复内容
- **智能依赖检查**：根据导入包类型决定是否检查 MySQL 客户端
- **SQLite 导入支持**：添加了 SQLite 数据库文件恢复功能
- **条件数据库导入**：根据导入包内容选择导入方法
- **改进验证逻辑**：支持两种数据库类型的验证

## 主要改进点

### exportData.sh
1. `check_dependencies()` 函数现在根据 `DB_TYPE` 进行条件检查
2. 新增 `export_sqlite_database()` 函数支持 SQLite 导出
3. 更新 `generate_metadata()` 函数正确反映数据库类型
4. 保持向后兼容性，不影响现有的 MySQL 导出功能

### importData.sh
1. `check_dependencies()` 函数现在根据 `NEED_MYSQL` 变量进行条件检查    
2. 新增 `import_sqlite_database()` 函数支持 SQLite 导入
3. `verify_import_package()` 函数自动检测数据库类型
4. 更新 `show_import_info()` 函数正确显示数据库信息

## 测试结果
修复后的脚本：
- ✅ 语法检查通过
- ✅ 在 SQLite 模式下不再报缺少 MySQL 依赖的错误
- ✅ 正确检测数据库类型
- ✅ 保持 MySQL 模式的完整功能
- ✅ 帮助信息显示正常
- ✅ 特定导出类型（--images-only、--files-only 等）跳过数据库依赖检查
- ✅ 支持单容器模式镜像导出（annual-leave-unified:latest）
- ✅ 成功导出单容器镜像并生成压缩包

## 使用方法

### 使用 SQLite 数据库导出
```bash
DB_TYPE=sqlite ./exportData.sh
```

### 使用 MySQL 数据库导出
```bash
./exportData.sh  # 默认使用 MySQL
```

### 导入 SQLite 备份
```bash
./importData.sh exports/your-backup-package.tar.gz
```

### 导入 MySQL 备份
```bash
./importData.sh exports/your-backup-package.tar.gz
```

## 向后兼容性
- 所有现有的 MySQL 导出/导入功能保持不变
- 新增的 SQLite 支持不会影响现有流程
- 自动检测数据库类型，无需用户手动指定

修复完成时间：2025-10-09 16:41
