# 二维码签到系统部署文档

## 系统概述

本系统为三个企业（汇博劳务公司、恒信劳务公司、临时工）分别创建了独立的二维码签到系统。每个企业都有两个专用二维码：
- **签到二维码**：用于员工签到，自动记录签到时间和公司信息
- **签退二维码**：用于员工签退，自动记录签退时间并计算工作时间

## 系统架构

### 数据表结构
系统使用现有的三个数据表：
- `huibo_labor_sign_records` - 汇博劳务公司签到记录
- `hengxin_labor_sign_records` - 恒信劳务公司签到记录  
- `temporary_labor_sign_records` - 临时工签到记录

### 表单系统
每个企业有两个表单：

**汇博劳务公司：**
- 签到表单：`huibo_qr_checkin`
- 签退表单：`huibo_qr_checkout`

**恒信劳务公司：**
- 签到表单：`hengxin_qr_checkin`
- 签退表单：`hengxin_qr_checkout`

**临时工：**
- 签到表单：`temporary_qr_checkin`
- 签退表单：`temporary_qr_checkout`

### 智能Hook功能
- **自动时间记录**：自动记录签到/签退时间
- **公司信息自动填充**：根据表单ID自动设置公司信息
- **工作时间计算**：自动计算实际工作时间

## 二维码访问地址

### 汇博劳务公司
- **签到二维码**：`http://localhost:3000/api/public/form/forms/huibo_qr_checkin`
- **签退二维码**：`http://localhost:3000/api/public/form/forms/huibo_qr_checkout`

### 恒信劳务公司
- **签到二维码**：`http://localhost:3000/api/public/form/forms/hengxin_qr_checkin`
- **签退二维码**：`http://localhost:3000/api/public/form/forms/hengxin_qr_checkout`

### 临时工
- **签到二维码**：`http://localhost:3000/api/public/form/forms/temporary_qr_checkin`
- **签退二维码**：`http://localhost:3000/api/public/form/forms/temporary_qr_checkout`

## 使用流程

### 员工使用流程
1. **签到**：扫描企业签到二维码 → 填写姓名和手机号 → 提交表单
2. **签退**：扫描企业签退二维码 → 填写姓名和手机号 → 提交表单

### 系统自动处理
- 自动记录当前时间作为签到/签退时间
- 自动识别并设置公司信息
- 自动计算工作时间（签退时）

## 部署脚本

系统提供了多个部署脚本：

### 主要部署脚本
- `创建二维码签到系统简化版.js` - 推荐使用，基于现有数据表
- `创建二维码签到系统完整版.js` - 完整版本（需要数据表创建权限）

### 辅助脚本
- `测试二维码签到系统.js` - 测试系统功能
- `修复二维码签到系统Hook.js` - 修复Hook配置
- `清理并重新创建Hook.js` - 清理和重新创建Hook

## 部署步骤

### 1. 检查服务器状态
```bash
curl http://localhost:3000/health
```

### 2. 执行部署脚本
```bash
cd @checkinSystem
node scripts/创建二维码签到系统简化版.js
```

### 3. 测试系统功能
```bash
# 测试签到功能
curl -X POST http://localhost:3000/api/public/form/forms/huibo_qr_checkin/submit \
  -H "Content-Type: application/json" \
  -d '{"data": {"name": "张三", "phone": "13800138000"}}'

# 测试签退功能  
curl -X POST http://localhost:3000/api/public/form/forms/huibo_qr_checkout/submit \
  -H "Content-Type: application/json" \
  -d '{"data": {"name": "张三", "phone": "13800138000"}}'
```

## 二维码生成

基于访问地址生成二维码：

### 推荐工具
- **在线二维码生成器**：使用上述访问地址生成二维码
- **微信小程序**：使用微信扫一扫功能
- **专业工具**：如草料二维码等

### 二维码使用建议
1. **打印尺寸**：建议10cm×10cm以上，确保扫描清晰
2. **放置位置**：企业入口处、办公区域等方便扫描的位置
3. **备份方案**：建议准备纸质签到表作为备用

## 数据查询

### 查询签到记录
可以通过数据浏览器查看各企业的签到记录：
- 汇博劳务公司：`huibo_labor_sign_records`
- 恒信劳务公司：`hengxin_labor_sign_records`
- 临时工：`temporary_labor_sign_records`

### 数据字段说明
- `name` - 姓名
- `phone` - 手机号
- `company` - 公司（自动设置）
- `sign_in_time` - 签到时间（自动记录）
- `sign_out_time` - 签退时间（自动记录）
- `work_hours` - 工作时间（自动计算）

## 故障排除

### 常见问题

**1. 表单提交失败**
- 检查服务器是否正常运行
- 检查网络连接
- 验证表单ID是否正确

**2. Hook执行错误**
- 检查Hook配置是否正确
- 查看服务器日志获取详细错误信息

**3. 二维码无法访问**
- 检查URL地址是否正确
- 确认服务器端口是否开放
- 验证网络连接

### 紧急修复
如果系统出现问题，可以执行修复脚本：
```bash
cd @checkinSystem
node scripts/修复二维码签到系统Hook.js
```

## 维护建议

### 定期检查
- 每月检查系统运行状态
- 定期备份数据
- 更新二维码（如有损坏）

### 性能优化
- 监控服务器性能
- 优化数据库查询
- 定期清理过期数据

## 技术支持

如需技术支持，请参考：
1. 系统部署说明文档
2. 故障排除指南
3. 联系系统管理员

---
*最后更新: 2025-11-20*
*系统状态: ✅ 正常运行*
