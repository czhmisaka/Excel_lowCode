# 自动获取签到表哈希值脚本使用说明

## 脚本概述

`自动获取签到表哈希值.js` 是一个自动化脚本，用于：
1. **自动获取所有表信息** - 从本地服务器获取所有表映射信息
2. **智能匹配目标表** - 自动查找 `sign_in_sheet` 表并提取哈希值
3. **自动更新配置文件** - 更新所有相关脚本中的哈希值配置
4. **自动创建表单定义** - 在系统中创建签到表单定义

## 脚本功能

### 核心功能
- ✅ **表信息获取** - 自动调用 `/api/mappings` 接口获取所有表
- ✅ **目标表匹配** - 智能查找 `sign_in_sheet` 表
- ✅ **哈希值提取** - 自动提取正确的表哈希值
- ✅ **配置更新** - 自动更新所有相关脚本文件
- ✅ **表单创建** - 自动创建签到系统表单定义

### 更新的配置文件
1. **签到系统增强脚本.js** - 更新表哈希值
2. **配置签到表字段.js** - 更新表哈希值  
3. **远程签到系统部署脚本.js** - 更新API地址

## 执行结果

### 当前配置状态
- **目标表**: `sign_in_sheet`
- **哈希值**: `65c97fd2268d95c3d222c8596dd893b1`
- **表单ID**: `labor_sign_in`
- **服务器**: `localhost:3000`

### 访问地址
- **表单页面**: http://localhost:5173/form?table=65c97fd2268d95c3d222c8596dd893b1
- **数据查询**: http://localhost:5173/browser?hash=65c97fd2268d95c3d222c8596dd893b1

## 使用方法

### 基本使用
```bash
# 执行自动配置脚本
node 自动获取签到表哈希值.js
```

### 自定义配置
可以修改脚本开头的配置项：
```javascript
const CONFIG = {
  API_BASE: 'http://localhost:3000/api',  // API地址
  TARGET_TABLE: 'sign_in_sheet',          // 目标表名
  TIMEOUT: 10000                          // 超时时间
};
```

### 模块化使用
脚本支持模块化调用：
```javascript
const { getAllTableMappings, findTargetTable } = require('./自动获取签到表哈希值.js');

// 获取所有表
const tables = await getAllTableMappings();

// 查找特定表
const targetTable = findTargetTable(tables, 'sign_in_sheet');
```

## 输出示例

```
🚀 开始自动获取签到表哈希值...
目标表: sign_in_sheet
API地址: http://localhost:3000/api
==================================================
🔍 正在获取所有表映射信息...
✅ 成功获取 3 个表
🔍 正在查找表: sign_in_sheet
✅ 找到目标表: sign_in_sheet
   哈希值: 65c97fd2268d95c3d222c8596dd893b1
   列数: 6
   行数: 3
   列定义:
     - name (string)
     - phone (number)
     - company (string)
     - sign_in_time (string)
     - sign_out_time (string)
     - work_hours (string)
📝 正在更新配置文件...
✅ 更新前端增强脚本成功
✅ 更新字段配置脚本成功
✅ 更新部署脚本成功
📋 正在创建表单定义...
✅ 签到表单创建成功
==================================================
🎉 自动配置完成！
```

## 错误处理

### 常见错误及解决方案
1. **服务器连接失败**
   - 检查服务器是否运行
   - 确认API地址正确

2. **目标表不存在**
   - 检查表名拼写
   - 确认表已正确导入系统

3. **配置文件更新失败**
   - 检查文件权限
   - 确认文件路径正确

### 错误输出示例
```
❌ 获取表映射信息失败: connect ECONNREFUSED 127.0.0.1:3000
❌ 未找到表: sign_in_sheet
可用的表列表:
   - 假期余额模板 (0bdb916b3eed7de2e95767459c35b915)
   - sheet1 (bccd28920161392036a2aac008b483f3)
```

## 集成到工作流

### 开发环境
```bash
# 每次表结构变更后执行
node 自动获取签到表哈希值.js
```

### 部署脚本
```bash
# 在部署流程中集成
echo "开始自动配置签到系统..."
node 自动获取签到表哈希值.js
echo "配置完成，开始部署..."
```

### CI/CD 集成
```yaml
# 在CI/CD流程中添加
- name: 自动配置签到系统
  run: node 自动获取签到表哈希值.js
```

## 维护说明

### 定期检查
- 监控表哈希值是否变化
- 验证表单定义是否正确
- 检查前端脚本功能

### 版本控制
- 脚本版本: 1.0
- 兼容性: Node.js 12+
- 依赖: axios

### 更新日志
- **v1.0** (2025-11-17)
  - 初始版本发布
  - 支持自动获取表信息和配置更新

## 技术支持

如遇问题，请检查：
1. 服务器连接状态
2. 表映射信息是否正确
3. 文件权限和路径
4. 网络连接状态

---
*最后更新: 2025-11-17*
*脚本状态: 已验证可用*
