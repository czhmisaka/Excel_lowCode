# 签到系统部署文档

## 系统概述

本项目实现了一个完整的签到打卡系统，支持多公司、多用户的签到签退管理。系统基于现有的Excel数据管理平台构建，提供了完整的用户管理、公司配置和签到记录功能。

## 系统架构

### 后端架构
- **Node.js + Express** - 后端服务框架
- **SQLite** - 数据库存储
- **Swagger** - API文档自动生成
- **JWT** - 用户认证

### 前端架构









- **Vue 3 + TypeScript** - 前端框架
- **Element Plus** - UI组件库
- **Vue Router** - 路由管理
- **Axios** - HTTP客户端

## 功能模块

### 1. 用户管理
- 用户注册和登录
- 手机号自动注册
- 用户信息管理
- 权限控制

### 2. 公司管理
- 公司信息配置
- 公司代码管理
- 公司状态管理
- 签到链接生成

### 3. 签到管理
- 用户签到
- 用户签退
- 工作时长计算
- 签到历史查询
- 今日状态查询

### 4. 数据统计
- 公司签到统计
- 用户签到记录
- 工作时长统计
- 活跃度分析

## 数据库设计

### 核心数据表

#### 1. users 用户表
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(20) UNIQUE NOT NULL,
    real_name VARCHAR(255),
    email VARCHAR(255),
    status VARCHAR(50) DEFAULT 'active',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 2. companies 公司表
```sql
CREATE TABLE companies (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(255) NOT NULL,
    code VARCHAR(100) UNIQUE NOT NULL,
    description TEXT,
    status VARCHAR(50) DEFAULT 'active',
    checkin_url VARCHAR(500),
    checkout_url VARCHAR(500),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 3. checkin_records 签到记录表
```sql
CREATE TABLE checkin_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    company_id INTEGER NOT NULL,
    checkin_time DATETIME NOT NULL,
    checkout_time DATETIME,
    work_duration INTEGER, -- 工作时长（分钟）
    location VARCHAR(500),
    ip_address VARCHAR(100),
    user_agent TEXT,
    status VARCHAR(50) DEFAULT 'active',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (company_id) REFERENCES companies(id)
);
```

## API接口

### 认证相关
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/register` - 用户注册
- `GET /api/auth/me` - 获取当前用户信息

### 用户管理
- `GET /api/users` - 获取用户列表
- `GET /api/users/phone/{phone}` - 根据手机号获取用户
- `POST /api/users/login` - 手机号登录/自动注册

### 公司管理
- `GET /api/companies` - 获取公司列表
- `GET /api/companies/code/{code}` - 根据公司代码获取公司信息
- `POST /api/companies` - 创建公司
- `PUT /api/companies/{id}` - 更新公司信息
- `DELETE /api/companies/{id}` - 删除公司

### 签到管理
- `POST /api/checkin/checkin` - 用户签到
- `POST /api/checkin/checkout` - 用户签退
- `GET /api/checkin/today-status` - 获取今日状态
- `GET /api/checkin/history` - 获取签到历史

## 前端页面

### 1. 签到页面
- **路径**: `/checkin/{companyCode}`
- **功能**: 用户签到
- **特点**: 手机号验证、自动用户注册、实时状态显示

### 2. 签退页面
- **路径**: `/checkout/{companyCode}`
- **功能**: 用户签退
- **特点**: 状态检查、工作时长计算、历史记录显示

### 3. 管理界面
- **路径**: `/admin/checkin`
- **功能**: 签到记录管理、公司配置、用户管理
- **特点**: 数据统计、批量操作、权限控制

## 部署说明

### 环境要求
- Node.js 16+
- SQLite 3
- 现代浏览器支持

### 后端部署
1. 安装依赖
```bash
cd backend
npm install
```

2. 配置环境变量
```bash
cp .env.example .env
# 编辑 .env 文件，配置数据库路径等参数
```

3. 启动服务
```bash
npm start
# 或开发模式
npm run dev
```

### 前端部署
1. 安装依赖
```bash
cd fe
npm install
```

2. 配置环境变量
```bash
cp .env.example .env
# 编辑 .env 文件，配置API地址等参数
```

3. 启动服务
```bash
npm run dev
# 或构建生产版本
npm run build
```

### Docker部署
```bash
# 使用Docker Compose一键部署
docker-compose up -d
```

## 使用流程

### 1. 系统初始化
1. 创建管理员账户
2. 配置公司信息
3. 生成签到链接

### 2. 用户使用
1. 访问公司专属签到链接
2. 输入手机号（首次使用自动注册）
3. 点击签到/签退
4. 查看签到记录和状态

### 3. 管理功能
1. 查看签到统计
2. 管理用户信息
3. 配置公司设置
4. 导出签到数据

## 安全特性

- JWT Token认证
- 输入验证和过滤
- SQL注入防护
- XSS攻击防护
- 请求频率限制

## 性能优化

- 数据库索引优化
- API响应缓存
- 前端资源压缩
- 图片懒加载
- 分页查询

## 监控和日志

- 系统健康检查
- 错误日志记录
- 性能监控
- 用户行为追踪

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查数据库文件路径
   - 确认文件读写权限
   - 验证数据库完整性

2. **API调用失败**
   - 检查网络连接
   - 验证API地址配置
   - 查看服务器日志

3. **用户认证失败**
   - 检查Token有效性
   - 验证用户状态
   - 确认权限设置

### 日志位置
- 后端日志: `backend/logs/`
- 前端日志: 浏览器开发者工具
- 系统日志: 服务器系统日志

## 扩展开发

### 添加新功能
1. 后端: 添加路由和控制器
2. 前端: 添加页面和组件
3. 数据库: 添加数据表和字段
4. 测试: 编写单元测试和集成测试

### 自定义配置
- 修改公司字段配置
- 调整签到规则
- 自定义工作时段
- 添加地理位置验证

## 技术支持

- 文档: 查看项目文档
- 问题: 提交GitHub Issue
- 邮件: 联系开发团队
- 社区: 加入开发者社区

---

**版本**: 1.0.0  
**最后更新**: 2025-11-26  
**维护团队**: 技术开发部







